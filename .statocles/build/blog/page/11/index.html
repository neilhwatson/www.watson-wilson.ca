<!DOCTYPE html>
<html>
    <head>
        <link href="//maxcdn.bootstrapcdn.com/bootstrap/3.3.5/css/bootstrap.min.css" rel="stylesheet">
        <script src="//ajax.googleapis.com/ajax/libs/jquery/2.1.4/jquery.min.js"></script>
        <script src="//maxcdn.bootstrapcdn.com/bootstrap/3.3.5/js/bootstrap.min.js"></script>
        <link href="/theme/css/readability-bootstrap.min.css" rel="stylesheet">
        <!--<link rel="stylesheet" href="/theme/css/statocles-bootstrap.css" />-->
        <link href="//maxcdn.bootstrapcdn.com/font-awesome/4.3.0/css/font-awesome.min.css" rel="stylesheet">
        <title>Neil H. Watson</title>
        <meta content="Statocles 0.073" name="generator">
        <link href="/blog/index.atom" rel="alternate" type="application/atom+xml">
        <link href="/blog/index.rss" rel="alternate" type="application/rss+xml">
        

        <!-- For source highlighting -->
        <link href="//cdnjs.cloudflare.com/ajax/libs/highlight.js/9.1.0/styles/default.min.css" rel="stylesheet">
        <script src="//cdnjs.cloudflare.com/ajax/libs/highlight.js/9.1.0/highlight.min.js"></script>
        <script>hljs.initHighlightingOnLoad();</script>

    </head>
    <body>
        <header>
            <nav class="navbar navbar-default navbar-static-top" role="navigation">
                <div class="container">
                <!-- Brand and toggle get grouped for better mobile display -->
                    <div class="navbar-header">
                        <button class="navbar-toggle" data-target="#top-navbar-collapse-1" data-toggle="collapse" type="button">
                            <span class="sr-only">Toggle navigation</span>
                            <span class="icon-bar"></span>
                            <span class="icon-bar"></span>
                            <span class="icon-bar"></span>
                        </button>
                        <a class="navbar-brand" href="/">Neil H. Watson</a>
                    </div>
                    <!-- Collect the nav links, forms, and other content for toggling -->
                    <div class="collapse navbar-collapse" id="top-navbar-collapse-1">
                        <ul class="nav navbar-nav">
                            <li><a href="/page/about">About me</a></li>
                            <li><a href="/static/resume_neil_h_watson.pdf">Resume</a></li>
                            <li><a href="/page/projects">Projects</a></li>
                        </ul>
                        
                    </div>
                </div>
            </nav>
            
        </header>
        <div class="main container">
            
<div class="row">

    <div class="col-md-9">
        <main>


            <article>
                <header>
                    <h1><a href="/blog/2013/07/19/polling-cfengine-with-opennms/">Polling CFEngine with Opennms</a></h1>

                    <p class="tags">Tags:
                        <a href="/blog/tag/Cfengine/" rel="tag">Cfengine</a>
                        <a href="/blog/tag/monitoring/" rel="tag">monitoring</a>
                        <a href="/blog/tag/opennms/" rel="tag">opennms</a>
                    </p>

                    <aside>
                        <p><time datetime="2013-07-19">
                            Posted on 2013-07-19
                        </time>
                            by nwatson
                        </p>
                    </aside>

                </header>

                <p>In the coming months I&#39;m going to work with and write about <a href="http://www.opennms.org">Opennms</a>.
Started in 1999, Opennms is a mature, open source, enterprise scale
monitoring system. --- In this first installment I offer you a way to
monitor CFEngine&#39;s cf-serverd on any host. Since cf-agent typically
promises that cf-serverd running, knowing that cf-serverd is running
tells you that the agent is working.</p>

<p>In my install, Opennms keeps most of its configuration files in
/etc/opennms. First edit capsd-configuration.xml, adding the following
section.</p>

<pre><code>&lt;protocol-plugin protocol=&quot;Cfengine&quot; class-name=&quot;org.opennms.netmgt.capsd.plugins.TcpPlugin&quot; scan=&quot;on&quot;&gt;
   &lt;property key=&quot;port&quot; value=&quot;5308&quot; /&gt;
   &lt;property key=&quot;timeout&quot; value=&quot;2000&quot; /&gt;
   &lt;property key=&quot;retry&quot; value=&quot;1&quot; /&gt;
&lt;/protocol-plugin&gt;
</code></pre>

<p>Second, edit poller-configuration.xml adding these sections.</p>

<pre><code>&lt;service name=&quot;Cfengine&quot; interval=&quot;300000&quot; user-defined=&quot;false&quot; status=&quot;on&quot;&gt;
   &lt;parameter key=&quot;retry&quot; value=&quot;2&quot; /&gt;
   &lt;parameter key=&quot;timeout&quot; value=&quot;3000&quot; /&gt;
   &lt;parameter key=&quot;port&quot; value=&quot;5308&quot;/&gt;
   &lt;parameter key=&quot;rrd-repository&quot; value=&quot;/opt/opennms/share/rrd/response&quot; /&gt;
   &lt;parameter key=&quot;rrd-base-name&quot; value=&quot;cfengine&quot; /&gt;
   &lt;parameter key=&quot;ds-name&quot; value=&quot;cfengine&quot; /&gt;
&lt;/service&gt;

&lt;monitor service=&quot;Cfengine&quot; class-name=&quot;org.opennms.netmgt.poller.monitors.TcpMonitor&quot; /&gt;
</code></pre>

<p>Restart Opennms, then you can manually rescan hosts immediately, or
wait for Opennms to do so in it&#39;s own time, usually overnight.</p>

<p>[caption id=&quot;attachment_521&quot; width=&quot;640&quot;]<a href="http://watson-wilson.ca/wp-content/uploads/2013/07/opennms-cfengine-polling.png"><img alt="screen shot of Opennms reporting CFEngine availability" src="http://watson-wilson.ca/wp-content/uploads/2013/07/opennms-cfengine-polling.png"></a>
Opennms reporting CFEngine availability. Notice anything shiny and
new?[/caption]</p>

<p>Sharp viewers will notice that my node is an IPV6 node. Opennms
supports IPV6, an important considering in the coming years.</p>



            </article>
            <article>
                <header>
                    <h1><a href="/blog/2013/05/09/pcre-cheatsheet/">PCRE cheatsheet</a></h1>

                    <p class="tags">Tags:
                        <a href="/blog/tag/Cfengine/" rel="tag">Cfengine</a>
                        <a href="/blog/tag/cheatsheet/" rel="tag">cheatsheet</a>
                        <a href="/blog/tag/pcre/" rel="tag">pcre</a>
                        <a href="/blog/tag/regex/" rel="tag">regex</a>
                    </p>

                    <aside>
                        <p><time datetime="2013-05-09">
                            Posted on 2013-05-09
                        </time>
                            by nwatson
                        </p>
                    </aside>

                </header>

                <p>Although similar to Perl, PCRE has some syntax that can be
difficult to remember. When I&#39;m working with CFEngine I often have to
look it up. Here is a cheat-sheet to save time.</p>


                    <p><a href="/blog/2013/05/09/pcre-cheatsheet/index.html#section-2">Continue reading PCRE cheatsheet...</a></p>

            </article>
            <article>
                <header>
                    <h1><a href="/blog/2013/05/09/its-time-to-rethink-anti-virus/">It&#39;s time to rethink Anti-virus</a></h1>

                    <p class="tags">Tags:
                        <a href="/blog/tag/anti-virus/" rel="tag">anti-virus</a>
                        <a href="/blog/tag/security/" rel="tag">security</a>
                        <a href="/blog/tag/virus/" rel="tag">virus</a>
                    </p>

                    <aside>
                        <p><time datetime="2013-05-09">
                            Posted on 2013-05-09
                        </time>
                            by nwatson
                        </p>
                    </aside>

                </header>

                <p>Anti-virus is always a step behind. It&#39;s a good revenue stream for
anti-virus software makers. For end users it&#39;s a race to the horizon.
--- Virus pattern recognition only works on patterns that have been
discovered, researched, and added to the pattern database. Recent
anti-virus pattern databases now detect more than 22 million patterns.
Is it a wonder that anti-virus software kills computer performance? <a href="http://www.symantec.com/security_response/definitions/certified/">1</a></p>

<p>The impossible pattern race is bad. The system crippling false alarms
are worse. In the recent past most major anti-virus tools have crippled
corporate and person computers by mistakenly quarantining a Windows
system or application file.<a href="http://www.theregister.co.uk/2013/02/06/kaspersky_win_xp_update_snafu/">1</a>,
<a href="http://www.theregister.co.uk/2012/09/20/sophos_auto_immune_update_chaos/">2</a>,
<a href="http://www.pcmag.com/article2/0,2817,2362926,00.asp">3</a></p>

<p>I&#39;m not a computer virus expert. But there has to be a better way to
protect us. I can think of some.</p>

<p>White listing defines what files are allowed to execute on a system.
Any file not on the white list is denied execution. For most corporate
workstations this is ideal. A few hundred executable files are white
listed and the workstation becomes secure. More generic workstations,
like home computers, require longer lists. This is not insurmountable.
I&#39;d rather subscribe to a ten thousand item white list than a 22
million item black list. The look ups will be shorter and new threats
do not get an automatic free pass.</p>

<p>Mandatory access control. SELinux is the well known form of MAC. MAC is
similar to white listing but goes further. Programs are not just denied
execution rights. Their rights to access the rest of the system are
explicitly defined. For example, a web browser may be allowed to touch
printing, browser cache, and other relevant files. Anything else is
denied, by default. Viruses cannot run wild on the system because
they&#39;ve not been defined to be allowed to do so. Set up and maintenance
of such a systems is no small task. Neither is maintaining a growing
list of 22 million virus definitions.</p>

<p>I&#39;m not a computer virus expert. But the arms race between new viruses
and new definitions can never be won. It&#39;s time for a new approach.
Consider that the next time your computer is churning another
anti-virus disk scan.</p>



            </article>
            <article>
                <header>
                    <h1><a href="/blog/2013/05/09/evolve-thinkings-free-cfengine-library/">Evolve Thinking&#39;s free CFEngine library</a></h1>

                    <p class="tags">Tags:
                        <a href="/blog/tag/Cfengine/" rel="tag">Cfengine</a>
                        <a href="/blog/tag/EFL/" rel="tag">EFL</a>
                    </p>

                    <aside>
                        <p><time datetime="2013-05-09">
                            Posted on 2013-05-09
                        </time>
                            by nwatson
                        </p>
                    </aside>

                </header>

                <p>Our free CFEngine library empowers users to build and deploy new
policy faster, simplify existing policy, and reduce staff training. ---
We do this by offering simple reusable bundles and full data separation
using CSV parameter files.</p>

<p>Just as CFEngine uses a handful of promises to affect so much change on
a host, our small collection of bundles can accomplish most high level
tasks in CFEngine.</p>

<p>Typical CFEngine bundles in use today are too specialized. A bundle for
cron tables, a bundle for resolv.conf, and another for NTP. This is too
specialized and too costly. There is a better way. Simpler bundles can
offer greater flexibility and easier reuse at a lower cost. A single
service bundle can promise cron tables, NTP, and more. A single editing
template bundle can promise resolv.conf, the hosts file, shell
profiles, and more. Our library does this and more.</p>

<p>Consider this data file for the bundle <em>efl_chkconfig_enable_service</em>.
If the context class is true then the given service is enabled for boot
time start using the chkconfig command.</p>

<pre><code># context(0) ;; service name(1) ;; Promisee(3)

any          ;; cfengine3       ;; Sysadmin team
web_server   ;; apache2         ;; Web team
dev.dns      ;; bind            ;; Dev team
</code></pre>

<p>You can call the bundle like this:</p>

<pre><code>&quot;enable with chkconfig&quot;
usebundle =&gt; efl_chkconfig_enable_service(
   &quot;${sys.workdir}/inputs/user_data/bundle_params/efl_chkconfig_enable_service.txt&quot;
);
</code></pre>

<p>To enable a new service, change only the data file. The promisee is
very important. It will help you to find all related data. Labelling a
promisee &quot;SSH services for DMZ&quot; will help find all SSH entries, in all
data files using a single search.</p>

<p>Our library offers a further step in data separation. The method above
can be placed in a data file. The bundle efl_main takes a data file
that describes method calls and parameters. For example:</p>

<pre><code># context(0) ;; promiser(1) ;; bundle(2) ;; ifelapsed(3) ;; parameter(4) ;; promisee(5)

any ;; host classes ;; efl_class_hostname ;; 1 ;; /var/cfengine/inputs/user_data/classes/efl_class_hostname-ipv6_only.txt ;; Neil Watson
any ;; chkconfig enable ;; efl_chkconfig_enable_service ;; 1 ;; /var/cfengine/inputs/user_data/bundle_params/efl_chkconfig_enable_service.txt ;; Neil Watson
</code></pre>

<p>When the given context is true a bundle is invoked with the given
parameter and using <em>ifelapsed</em>.</p>

<p>At this release the free library offer these bundles and more:</p>

<ul>
<li><p>Enable and disable services using chkconfig.</p></li>
<li><p>Install and remove packages.</p></li>
<li><p>Promise sysctl.conf.</p></li>
<li><p>Promise live sysctl kernel settings.</p></li>
<li><p>Delete files.</p></li>
<li><p>Copy files.</p></li>
<li><p>Edit templates.</p></li>
<li><p>Promise commands.</p></li>
<li><p>Define classes</p></li>
<li><p>Promise links.</p></li>
<li><p>Define global variables.</p></li>
<li><p>Promise that services are configured and running.</p></li>
<li><p>Promise file permissions.</p></li>
</ul>

<p>In the future we&#39;ll be offering special purpose bundles that use these
simple bundles, ready to use parameter files, and more.</p>

<p>The Evolve free library is open source and available at our <a href="https://github.com/evolvethinking/">Git Hub
site.</a></p>



            </article>
            <article>
                <header>
                    <h1><a href="/blog/2013/02/22/dns-renaming/">Avoid the cost of renaming hundreds of hosts</a></h1>

                    <p class="tags">Tags:
                        <a href="/blog/tag/dns/" rel="tag">dns</a>
                    </p>

                    <aside>
                        <p><time datetime="2013-02-22">
                            Posted on 2013-02-22
                        </time>
                        </p>
                    </aside>

                </header>

                <p>Your hosts are named after your data centre. Now you must move hundreds of
hosts to another data centre. Do you rename them or abandon the naming
convention?</p>

<p>A client of mine is facing this challenge. I&#39;ve discussed host naming before..
Host are not static. They change functions and locations. Think ahead before
naming them.</p>



            </article>
        </main>

        <ul class="pager">
            <li class="previous ">
                <a href="/blog/page/12" rel="next"><span aria-hidden="true" class="glyphicon glyphicon-chevron-left"></span>Older</a>
            </li>
            <li class="next ">
                <a href="/blog/page/10" rel="prev">Newer<span aria-hidden="true" class="glyphicon glyphicon-chevron-right"></span></a>
            </li>
        </ul>

    </div>

    <div class="sidebar col-md-3">
        <iframe frameborder="0" src="https://duckduckgo.com/search.html?site=watson-wilson.ca&amp;prefill=Search DuckDuckGo" style="overflow:hidden;margin:0;padding:0;width:350px;height:40px;"></iframe>

        <h1>Tags</h1>
        <ul class="list-inline">
            <li><a href="/blog/tag/Cfengine/">Cfengine</a></li>
            <li><a href="/blog/tag/EFL/">EFL</a></li>
            <li><a href="/blog/tag/anti-virus/">anti-virus</a></li>
            <li><a href="/blog/tag/apt/">apt</a></li>
            <li><a href="/blog/tag/backup/">backup</a></li>
            <li><a href="/blog/tag/best-practices/">best practices</a></li>
            <li><a href="/blog/tag/cfengine/">cfengine</a></li>
            <li><a href="/blog/tag/cfengine-cookbook/">cfengine cookbook</a></li>
            <li><a href="/blog/tag/cheatsheet/">cheatsheet</a></li>
            <li><a href="/blog/tag/cli/">cli</a></li>
            <li><a href="/blog/tag/cloud/">cloud</a></li>
            <li><a href="/blog/tag/cluster/">cluster</a></li>
            <li><a href="/blog/tag/conferences/">conferences</a></li>
            <li><a href="/blog/tag/configuration-management/">configuration management</a></li>
            <li><a href="/blog/tag/cron/">cron</a></li>
            <li><a href="/blog/tag/debian/">debian</a></li>
            <li><a href="/blog/tag/delta-reporting/">delta reporting</a></li>
            <li><a href="/blog/tag/devops/">devops</a></li>
            <li><a href="/blog/tag/dns/">dns</a></li>
            <li><a href="/blog/tag/dr/">dr</a></li>
            <li><a href="/blog/tag/heartbeat/">heartbeat</a></li>
            <li><a href="/blog/tag/high-availability/">high availability</a></li>
            <li><a href="/blog/tag/infosec/">infosec</a></li>
            <li><a href="/blog/tag/ipv6/">ipv6</a></li>
            <li><a href="/blog/tag/irc/">irc</a></li>
            <li><a href="/blog/tag/iscsi/">iscsi</a></li>
            <li><a href="/blog/tag/jekyll/">jekyll</a></li>
            <li><a href="/blog/tag/kickstart/">kickstart</a></li>
            <li><a href="/blog/tag/kvm/">kvm</a></li>
            <li><a href="/blog/tag/linux/">linux</a></li>
            <li><a href="/blog/tag/monitoring/">monitoring</a></li>
            <li><a href="/blog/tag/multipathd/">multipathd</a></li>
            <li><a href="/blog/tag/mustache/">mustache</a></li>
            <li><a href="/blog/tag/networking/">networking</a></li>
            <li><a href="/blog/tag/opennms/">opennms</a></li>
            <li><a href="/blog/tag/opensource/">opensource</a></li>
            <li><a href="/blog/tag/oracle/">oracle</a></li>
            <li><a href="/blog/tag/patching/">patching</a></li>
            <li><a href="/blog/tag/pcre/">pcre</a></li>
            <li><a href="/blog/tag/perl/">perl</a></li>
            <li><a href="/blog/tag/posix/">posix</a></li>
            <li><a href="/blog/tag/programming/">programming</a></li>
            <li><a href="/blog/tag/provisioning/">provisioning</a></li>
            <li><a href="/blog/tag/red-hat/">red hat</a></li>
            <li><a href="/blog/tag/redhat/">redhat</a></li>
            <li><a href="/blog/tag/regex/">regex</a></li>
            <li><a href="/blog/tag/rhev/">rhev</a></li>
            <li><a href="/blog/tag/san/">san</a></li>
            <li><a href="/blog/tag/satellite/">satellite</a></li>
            <li><a href="/blog/tag/scripting/">scripting</a></li>
            <li><a href="/blog/tag/security/">security</a></li>
            <li><a href="/blog/tag/serverspec/">serverspec</a></li>
            <li><a href="/blog/tag/shell/">shell</a></li>
            <li><a href="/blog/tag/software-testing/">software testing</a></li>
            <li><a href="/blog/tag/solaris/">solaris</a></li>
            <li><a href="/blog/tag/spacewalk/">spacewalk</a></li>
            <li><a href="/blog/tag/ssh/">ssh</a></li>
            <li><a href="/blog/tag/statocles/">statocles</a></li>
            <li><a href="/blog/tag/subversion/">subversion</a></li>
            <li><a href="/blog/tag/sun/">sun</a></li>
            <li><a href="/blog/tag/support/">support</a></li>
            <li><a href="/blog/tag/svn/">svn</a></li>
            <li><a href="/blog/tag/sysadmin/">sysadmin</a></li>
            <li><a href="/blog/tag/sysctl/">sysctl</a></li>
            <li><a href="/blog/tag/terraform/">terraform</a></li>
            <li><a href="/blog/tag/virus/">virus</a></li>
            <li><a href="/blog/tag/vitualization/">vitualization</a></li>
            <li><a href="/blog/tag/website/">website</a></li>
        </ul>
        <h1>Feeds</h1>
        <ul class="list-inline">
            <li>
                <a href="/blog/index.atom" rel="alternate" type="application/atom+xml">
                    Atom
                </a>
            </li>
            <li>
                <a href="/blog/index.rss" rel="alternate" type="application/rss+xml">
                    RSS
                </a>
            </li>
        </ul>
    </div>

</div>


        </div>
        <footer>
            
            <h1></h1>
            <div class="col-md-5"> </div>
            <div class="col-md-3 container tagline">
                <a href="http://preaction.me/statocles">Made with Statocles</a><br>
                <a href="http://www.perl.org">Powered by Perl</a>
            </div>
        </footer>
    </body>
</html>
