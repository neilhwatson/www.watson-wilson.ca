<!DOCTYPE html>
<html lang="en"> 
    <head>
        <meta http-equiv="Content-Type" content="text/html; charset=utf-8"/>
        <link rel="stylesheet" href="//maxcdn.bootstrapcdn.com/bootstrap/3.3.5/css/bootstrap.min.css" />
        <script src="//ajax.googleapis.com/ajax/libs/jquery/2.1.4/jquery.min.js"></script>
        <script src="//maxcdn.bootstrapcdn.com/bootstrap/3.3.5/js/bootstrap.min.js"></script>
        <link rel="stylesheet" href="/theme/css/readability-bootstrap.min.css" />
        <!--<link rel="stylesheet" href="/theme/css/statocles-bootstrap.css" />-->
        <link rel="stylesheet" href="//maxcdn.bootstrapcdn.com/font-awesome/4.3.0/css/font-awesome.min.css">
        <title>Serverspec, the good, the bad, and the ugly - Neil H. Watson</title>
        <meta name="generator" content="Statocles 0.093" />
        

        <!-- For source highlighting -->
        <link rel="stylesheet" href="//cdnjs.cloudflare.com/ajax/libs/highlight.js/9.1.0/styles/default.min.css">
        <script src="//cdnjs.cloudflare.com/ajax/libs/highlight.js/9.1.0/highlight.min.js"></script>
        <script>hljs.initHighlightingOnLoad();</script>

    </head>
    <body>
        <header>
            <nav class="navbar navbar-default navbar-static-top" role="navigation">
                <div class="container">
                <!-- Brand and toggle get grouped for better mobile display -->
                    <div class="navbar-header">
                        <button type="button" class="navbar-toggle" data-toggle="collapse" data-target="#top-navbar-collapse-1">
                            <span class="sr-only">Toggle navigation</span>
                            <span class="icon-bar"></span>
                            <span class="icon-bar"></span>
                            <span class="icon-bar"></span>
                        </button>
                        <a class="navbar-brand" href="/">Neil H. Watson</a>
                    </div>
                    <!-- Collect the nav links, forms, and other content for toggling -->
                    <div class="collapse navbar-collapse" id="top-navbar-collapse-1">
                        <ul class="nav navbar-nav">
                            <li><a href="/page/about">About me</a></li>
                            <li><a href="/static/resume_neil_h_watson.pdf">Resume</a></li>
                            <li><a href="/page/projects">Projects</a></li>
                            <li><a href="/page/evolvethinking">UPDATE: EvolveThinking</a></li>
                        </ul>
                        
                    </div>
                </div>
            </nav>
            
        </header>
        <div class="main container">
            <div class="row">

    <div class="col-md-9">
        <main>
            <header>
                <h1>Serverspec, the good, the bad, and the ugly</h1>
                <p class="tags">Tags:
                    <a href="/blog/tag/cfengine/" rel="tag">cfengine</a>
                    <a href="/blog/tag/serverspec/" rel="tag">serverspec</a>
                    <a href="/blog/tag/software-testing/" rel="tag">software testing</a>
                </p>

                <aside>
                    <p><time datetime="2015-06-18">
                        Posted on 2015-06-18
                    </time>
                        by nwatson
                    </p>
                </aside>


            </header>
            <section id="section-1">
                <p>I've been using a talking about <a href="http://serverspec.org">Serverspec</a>
lately. Let me tell you about the surprises I found.</p>

            </section>
            <section id="section-2">
                <h2>A Quick Introduction</h2>

<p>Severspec is a Ruby powered tool the tests server configuration. You
write a description of a systems configuration (e.g. packages
installed, processes running, file hashes and contents) and Serverspec
tests one or more hosts against it. It uses SSH and Sudo to test remote
hosts and, optionally, with privileges.</p>

<h2>Goal: testing multiple hosts</h2>

<p>I have a group of CFEngine servers that I want to test against a
desired standard. I could use CFEngine, but I prefer a third party tool
for better confirmation. The Serverspec file looks like this:</p>

<pre><code>require 'spec_helper'
require 'socket'

describe package('cfengine-community') do
   it { should be_installed }
end

describe command( '/var/cfengine/bin/cf-promises --version') do
   its(:stdout) { should match /3\.6\.5/ }
end

# Removed due to bug
# describe service( 'cfengine3' ) do
   # it { should be_enabled }
# end

describe "CFEngine service should start at boot, chkconfig cfengine3" do
   describe command( '/sbin/chkconfig cfengine3' ) do
      its(:exit_status) { should eq 0 }
   end
end

for proc in [ 'execd', 'serverd', 'monitord' ]
   describe process( "cf-#{proc}" ) do
      it { should be_running }
      its(:user) { should eq 'root' }
   end
end

describe port(5308) do
  it { should be_listening }
end
</code></pre>

<p>When you run the test with <code>rake spec</code> it makes all those tests against
the target machines and returns a report.</p>

<h3>Bug</h3>

<p>As you see the example, I commented out a service test. This test is
supposed to examine the return code of <code>chkconfig --list cfengin3|grep
3:on</code> but it always failed. Serverspec's Github repository has issue
tracking disabled so I was not able to submit a bug report, and the
maintainer did not return my email.</p>

<h3>Testing multiple hosts</h3>

<p>The Advanced Tips section of <a href="http://serverspec.org/advanced_tips.html">serverspec.org</a>
provides tips on how to test multiple hosts against a single set of
tests. This didn't work well. Testing would stop after the first
failure rather continuing to each test and each host. With no
Serverspec community I was limited in who I could ask for help, but I
did ask a colleague who spoke about Serverspec at Devops Days Toronto.
He was not able to make this work either. Eventually I was able to get
help on <a href="http://stackoverflow.com/questions/30867597/making-serverspec-mutlit-host-tests-continue-even-on-a-test-failure">Stackoverflow</a>.
Thank you Arthur Maltson (<a href="https://twitter.com/amaltson">@amatlson</a>),
and <a href="http://stackoverflow.com/users/3464137/egwspiti">egwspiti</a> for
helping me.</p>

<h2>The good, the bad, and the ugly</h2>

<h3>The good</h3>

<p>A full range of testing features to cover most of your needs all in a
simple descriptive language.</p>

<h3>The bad</h3>

<p>Documentation lacks detail.</p>

<h3>The ugly</h3>

<p>A lack of community and creator support.</p>

<ul>
<li><p>no bug submissions</p></li>
<li><p>no user mailing list or forum</p></li>
<li><p>dead irc channel on Freenode</p></li>
<li><p>Stackoverflow community is small, just 8 followers and 33
questions.</p></li>
<li><p>Git maintainer did not answer my email</p></li>
</ul>

            </section>
        </main>


    </div>

    <div class="col-md-3">
        <iframe src="https://duckduckgo.com/search.html?site=watson-wilson.ca&prefill=Search DuckDuckGo" style="overflow:hidden;margin:0;padding:0;width:350px;height:40px;" frameborder="0"></iframe>

        <nav id="tags">
            <h1>Tags</h1>
            <ul class="list-inline">
                <li><a href="/blog/tag/ansible/">ansible</a></li>
                <li><a href="/blog/tag/anti-virus/">anti-virus</a></li>
                <li><a href="/blog/tag/apt/">apt</a></li>
                <li><a href="/blog/tag/asg/">asg</a></li>
                <li><a href="/blog/tag/autoscaling/">autoscaling</a></li>
                <li><a href="/blog/tag/aws/">AWS</a></li>
                <li><a href="/blog/tag/azure/">azure</a></li>
                <li><a href="/blog/tag/backup/">backup</a></li>
                <li><a href="/blog/tag/best-practices/">best practices</a></li>
                <li><a href="/blog/tag/bitbucket/">bitbucket</a></li>
                <li><a href="/blog/tag/bosh/">bosh</a></li>
                <li><a href="/blog/tag/cfengine/">cfengine</a></li>
                <li><a href="/blog/tag/cfengine-cookbook/">cfengine cookbook</a></li>
                <li><a href="/blog/tag/cheatsheet/">cheatsheet</a></li>
                <li><a href="/blog/tag/cli/">cli</a></li>
                <li><a href="/blog/tag/cloud/">cloud</a></li>
                <li><a href="/blog/tag/cloud-foundry/">cloud foundry</a></li>
                <li><a href="/blog/tag/cluster/">cluster</a></li>
                <li><a href="/blog/tag/conferences/">conferences</a></li>
                <li><a href="/blog/tag/configuration-management/">configuration management</a></li>
                <li><a href="/blog/tag/containers/">containers</a></li>
                <li><a href="/blog/tag/continuous-integration/">continuous integration</a></li>
                <li><a href="/blog/tag/cron/">cron</a></li>
                <li><a href="/blog/tag/debian/">debian</a></li>
                <li><a href="/blog/tag/delta-reporting/">delta reporting</a></li>
                <li><a href="/blog/tag/devops/">devops</a></li>
                <li><a href="/blog/tag/dns/">dns</a></li>
                <li><a href="/blog/tag/docker/">docker</a></li>
                <li><a href="/blog/tag/dr/">dr</a></li>
                <li><a href="/blog/tag/efl/">EFL</a></li>
                <li><a href="/blog/tag/github/">github</a></li>
                <li><a href="/blog/tag/heartbeat/">heartbeat</a></li>
                <li><a href="/blog/tag/high-availability/">high availability</a></li>
                <li><a href="/blog/tag/infosec/">infosec</a></li>
                <li><a href="/blog/tag/ipv6/">ipv6</a></li>
                <li><a href="/blog/tag/irc/">irc</a></li>
                <li><a href="/blog/tag/iscsi/">iscsi</a></li>
                <li><a href="/blog/tag/jekyll/">jekyll</a></li>
                <li><a href="/blog/tag/jq/">jq</a></li>
                <li><a href="/blog/tag/json/">json</a></li>
                <li><a href="/blog/tag/kickstart/">kickstart</a></li>
                <li><a href="/blog/tag/kvm/">kvm</a></li>
                <li><a href="/blog/tag/linux/">linux</a></li>
                <li><a href="/blog/tag/markdown/">markdown</a></li>
                <li><a href="/blog/tag/monitoring/">monitoring</a></li>
                <li><a href="/blog/tag/multipathd/">multipathd</a></li>
                <li><a href="/blog/tag/mustache/">mustache</a></li>
                <li><a href="/blog/tag/networking/">networking</a></li>
                <li><a href="/blog/tag/opennms/">opennms</a></li>
                <li><a href="/blog/tag/opensource/">opensource</a></li>
                <li><a href="/blog/tag/oracle/">oracle</a></li>
                <li><a href="/blog/tag/orchestration/">orchestration</a></li>
                <li><a href="/blog/tag/patching/">patching</a></li>
                <li><a href="/blog/tag/pcre/">pcre</a></li>
                <li><a href="/blog/tag/perl/">perl</a></li>
                <li><a href="/blog/tag/posix/">posix</a></li>
                <li><a href="/blog/tag/programming/">programming</a></li>
                <li><a href="/blog/tag/provisioning/">provisioning</a></li>
                <li><a href="/blog/tag/python/">python</a></li>
                <li><a href="/blog/tag/red-hat/">red hat</a></li>
                <li><a href="/blog/tag/redhat/">redhat</a></li>
                <li><a href="/blog/tag/regex/">regex</a></li>
                <li><a href="/blog/tag/rhev/">rhev</a></li>
                <li><a href="/blog/tag/ruby/">ruby</a></li>
                <li><a href="/blog/tag/san/">san</a></li>
                <li><a href="/blog/tag/satellite/">satellite</a></li>
                <li><a href="/blog/tag/scripting/">scripting</a></li>
                <li><a href="/blog/tag/security/">security</a></li>
                <li><a href="/blog/tag/serverspec/">serverspec</a></li>
                <li><a href="/blog/tag/shell/">shell</a></li>
                <li><a href="/blog/tag/slaac/">slaac</a></li>
                <li><a href="/blog/tag/software-testing/">software testing</a></li>
                <li><a href="/blog/tag/solaris/">solaris</a></li>
                <li><a href="/blog/tag/spacewalk/">spacewalk</a></li>
                <li><a href="/blog/tag/ssh/">ssh</a></li>
                <li><a href="/blog/tag/statocles/">statocles</a></li>
                <li><a href="/blog/tag/subversion/">subversion</a></li>
                <li><a href="/blog/tag/sun/">sun</a></li>
                <li><a href="/blog/tag/support/">support</a></li>
                <li><a href="/blog/tag/svn/">svn</a></li>
                <li><a href="/blog/tag/sysadmin/">sysadmin</a></li>
                <li><a href="/blog/tag/sysctl/">sysctl</a></li>
                <li><a href="/blog/tag/terraform/">terraform</a></li>
                <li><a href="/blog/tag/virus/">virus</a></li>
                <li><a href="/blog/tag/vitualization/">vitualization</a></li>
                <li><a href="/blog/tag/website/">website</a></li>
                <li><a href="/blog/tag/yaml/">yaml</a></li>
                <li><a href="/blog/tag/yamllint/">yamllint</a></li>
            </ul>
        </nav>
    </div>

</div>

<div class='row'>
   <div class='col-md-1'>
       <img atl='Neil Watson' src='https://gravatar.com/avatar/1f0969599955a953e592034929ed7a23' >
   </div>

       <div class='col-md-1'>
            <!-- reddit this -->
            <a href="//www.reddit.com/submit" onclick="window.location = '//www.reddit.com/submit?url=' + encodeURIComponent(window.location); return false"><img src="//www.redditstatic.com/spreddit7.gif" alt="submit to reddit" border="0" /></a>
       </div>

       <div class='col-md-1'>
          <!-- Tweet this -->
          <a href="https://twitter.com/share" class="twitter-share-button" data-via="neil_h_watson" data-count="none">Tweet</a>
    <script>!function(d,s,id){var js,fjs=d.getElementsByTagName(s)[0],p=/^http:/.test(d.location)?'http':'https';if(!d.getElementById(id)){js=d.createElement(s);js.id=id;js.src=p+'://platform.twitter.com/widgets.js';fjs.parentNode.insertBefore(js,fjs);}}(document, 'script', 'twitter-wjs');</script>
       </div>

       <div class='col-md-1'>
          <!-- follow me on twitter -->
          <a href="https://twitter.com/neil_h_watson" class="twitter-follow-button" data-show-count="false" data-show-screen-name="false">Follow @neil_h_watson</a>
<script>!function(d,s,id){var js,fjs=d.getElementsByTagName(s)[0],p=/^http:/.test(d.location)?'http':'https';if(!d.getElementById(id)){js=d.createElement(s);js.id=id;js.src=p+'://platform.twitter.com/widgets.js';fjs.parentNode.insertBefore(js,fjs);}}(document, 'script', 'twitter-wjs');</script>
        </div>

       <div class='col-md-1'>
           <!-- follw me on github -->
            <a aria-label="Follow @neilhwatson on GitHub" data-style="mega" href="https://github.com/neilhwatson" class="github-button">Follow</a>
            <script async defer id="github-bjs" src="https://buttons.github.io/buttons.js"></script>
       </div>

</div>

        </div>
        <footer>
            
            <h1></h1>
            <div class='col-md-5'> </div>
            <div class="col-md-3 container tagline">
                <a href="http://preaction.me/statocles">Made with Statocles</a><br/>
                <a href="http://www.perl.org">Powered by Perl</a>
            </div>
        </footer>
    </body>
</html>
