<!DOCTYPE html>
<html>
    <head>
        <link href="//maxcdn.bootstrapcdn.com/bootstrap/3.3.5/css/bootstrap.min.css" rel="stylesheet">
        <script src="//ajax.googleapis.com/ajax/libs/jquery/2.1.4/jquery.min.js"></script>
        <script src="//maxcdn.bootstrapcdn.com/bootstrap/3.3.5/js/bootstrap.min.js"></script>
        <link href="/theme/css/readability-bootstrap.min.css" rel="stylesheet">
        <!--<link rel="stylesheet" href="/theme/css/statocles-bootstrap.css" />-->
        <link href="//maxcdn.bootstrapcdn.com/font-awesome/4.3.0/css/font-awesome.min.css" rel="stylesheet">
        <title>New packages promises in EFL - Neil H. Watson</title>
        <meta content="Statocles 0.073" name="generator">
        

        <!-- For source highlighting -->
        <link href="//cdnjs.cloudflare.com/ajax/libs/highlight.js/9.1.0/styles/default.min.css" rel="stylesheet">
        <script src="//cdnjs.cloudflare.com/ajax/libs/highlight.js/9.1.0/highlight.min.js"></script>
        <script>hljs.initHighlightingOnLoad();</script>

    </head>
    <body>
        <header>
            <nav class="navbar navbar-default navbar-static-top" role="navigation">
                <div class="container">
                <!-- Brand and toggle get grouped for better mobile display -->
                    <div class="navbar-header">
                        <button class="navbar-toggle" data-target="#top-navbar-collapse-1" data-toggle="collapse" type="button">
                            <span class="sr-only">Toggle navigation</span>
                            <span class="icon-bar"></span>
                            <span class="icon-bar"></span>
                            <span class="icon-bar"></span>
                        </button>
                        <a class="navbar-brand" href="/">Neil H. Watson</a>
                    </div>
                    <!-- Collect the nav links, forms, and other content for toggling -->
                    <div class="collapse navbar-collapse" id="top-navbar-collapse-1">
                        <ul class="nav navbar-nav">
                            <li><a href="/page/about">About me</a></li>
                            <li><a href="/static/resume_neil_h_watson.pdf">Resume</a></li>
                            <li><a href="/page/projects">Projects</a></li>
                        </ul>
                        
                    </div>
                </div>
            </nav>
            
        </header>
        <div class="main container">
            <div class="row">

    <div class="col-md-9">
        <main>
            <header>
                <h1>New packages promises in EFL</h1>
                <p class="tags">Tags:
                    <a href="/blog/tag/Cfengine/" rel="tag">Cfengine</a>
                    <a href="/blog/tag/EFL/" rel="tag">EFL</a>
                    <a href="/blog/tag/provisioning/" rel="tag">provisioning</a>
                </p>

                <aside>
                    <p><time datetime="2015-07-29">
                        Posted on 2015-07-29
                    </time>
                        by nwatson
                    </p>
                </aside>


            </header>
            <section id="section-1">
                <p><img alt="A package" src="http://watson-wilson.ca/wp-content/uploads/2015/07/cubimal-package.png"></p>

<p>Good news everyone. CFEngine 3.7 has revamped packages promises making
them simpler and more reliable. These new promises are now used in EFL
with the bundle efl_packages_new. The bundle&#39;s parameter file looks
like this:</p>

            </section>
            <section id="section-2">
                <p>Call the bundle (but using efl_main is recommended).</p>

<p>``</p>

<pre><code>&quot;my packages&quot;
   usebunnde =&gt; efl_packages_new(
      &#39;${sys.inputdir}/efl_data/bundle_params/packages.csv&#39; );
</code></pre>

<p>In csv format. ``</p>

<pre><code># class ;; policy  ;; package ;; version ;; arch  ;; promisee
any     ;; absent  ;; nano    ;; 0       ;; amd64 ;; efl development
any     ;; present ;; e3      ;; 0       ;; amd64 ;; efl development
</code></pre>

<p>These parameters are almost identical to the efl_packages and
efl_packages_via_cmd. You need only alter the policy and the version.
The policy now has only two forms: absent and present. The previous
forms: delete, add, update, and patch have been depreciated. The
version has two forms, 0 means use the latest version the package
manager can find. Otherwise you must specify the precise version
string. The new packages promises do not permit more complex version
comparison at this time.</p>

<p><strong>Note: You must enable the packages_module in promises.cf&#39;s <a href="https://github.com/cfengine/masterfiles/blob/master/promises.cf#L68">common
body control</a></strong>:</p>

<p>``</p>

<pre><code>package_inventory =&gt; { $(package_module_knowledge.platform_default) };
</code></pre>

<p>Modules are the new interface between CFEngine and package managers.
Currently only yum and apt-get are supported. See <a href="https://github.com/cfengine/masterfiles/blob/master/modules/packages/apt_get">here</a>
for the gory details.</p>

<p>Don&#39;t like the pseudo CSV files? Then you can use JSON format. EFL even
comes with a conversion tool, <a href="https://github.com/evolvethinking/evolve_cfengine_freelib/blob/master/bin/eflconvert">eflconvert</a>.
I converted the above csv file like this:</p>

<p>``</p>

<pre><code>eflconvert -b efl_packages -i csv -o json &lt; 01_packages.csv
</code></pre>

<p>In JSON format. ``</p>

<pre><code>[
   {
      &quot;package_name&quot; : &quot;nano&quot;,
      &quot;class&quot; : &quot;any&quot;,
      &quot;promisee&quot; : &quot;efl development&quot;,
      &quot;package_version&quot; : &quot;0&quot;,
      &quot;package_policy&quot; : &quot;absent&quot;,
      &quot;architecture&quot; : &quot;amd64&quot;
   },
   {
      &quot;package_policy&quot; : &quot;present&quot;,
      &quot;architecture&quot; : &quot;amd64&quot;,
      &quot;promisee&quot; : &quot;efl development&quot;,
      &quot;package_version&quot; : &quot;0&quot;,
      &quot;package_name&quot; : &quot;e3&quot;,
      &quot;class&quot; : &quot;any&quot;
   }
]
</code></pre>

<h4>Coming soon YAML format!</h4>

<p>``</p>

<pre><code>eflconvert -b efl_packages -i json -o yaml &lt; 01_packages.json
</code></pre>

<p>In YAML format ``</p>

<pre><code>---
- architecture: amd64
  class: any
  package_name: nano
  package_policy: absent
  package_version: 0
  promisee: efl development
- architecture: amd64
  class: any
  package_name: e3
  package_policy: present
  package_version: 0
  promisee: efl development
</code></pre>

            </section>
        </main>


    </div>

    <div class="col-md-3">
        <iframe frameborder="0" src="https://duckduckgo.com/search.html?site=watson-wilson.ca&amp;prefill=Search DuckDuckGo" style="overflow:hidden;margin:0;padding:0;width:350px;height:40px;"></iframe>

        <nav id="tags">
            <h1>Tags</h1>
            <ul class="list-inline">
                <li><a href="/blog/tag/Cfengine/">Cfengine</a></li>
                <li><a href="/blog/tag/EFL/">EFL</a></li>
                <li><a href="/blog/tag/anti-virus/">anti-virus</a></li>
                <li><a href="/blog/tag/apt/">apt</a></li>
                <li><a href="/blog/tag/backup/">backup</a></li>
                <li><a href="/blog/tag/best-practices/">best practices</a></li>
                <li><a href="/blog/tag/cfengine/">cfengine</a></li>
                <li><a href="/blog/tag/cfengine-cookbook/">cfengine cookbook</a></li>
                <li><a href="/blog/tag/cheatsheet/">cheatsheet</a></li>
                <li><a href="/blog/tag/cli/">cli</a></li>
                <li><a href="/blog/tag/cloud/">cloud</a></li>
                <li><a href="/blog/tag/cluster/">cluster</a></li>
                <li><a href="/blog/tag/conferences/">conferences</a></li>
                <li><a href="/blog/tag/configuration-management/">configuration management</a></li>
                <li><a href="/blog/tag/cron/">cron</a></li>
                <li><a href="/blog/tag/debian/">debian</a></li>
                <li><a href="/blog/tag/delta-reporting/">delta reporting</a></li>
                <li><a href="/blog/tag/devops/">devops</a></li>
                <li><a href="/blog/tag/dns/">dns</a></li>
                <li><a href="/blog/tag/dr/">dr</a></li>
                <li><a href="/blog/tag/heartbeat/">heartbeat</a></li>
                <li><a href="/blog/tag/high-availability/">high availability</a></li>
                <li><a href="/blog/tag/infosec/">infosec</a></li>
                <li><a href="/blog/tag/ipv6/">ipv6</a></li>
                <li><a href="/blog/tag/irc/">irc</a></li>
                <li><a href="/blog/tag/iscsi/">iscsi</a></li>
                <li><a href="/blog/tag/jekyll/">jekyll</a></li>
                <li><a href="/blog/tag/kickstart/">kickstart</a></li>
                <li><a href="/blog/tag/kvm/">kvm</a></li>
                <li><a href="/blog/tag/linux/">linux</a></li>
                <li><a href="/blog/tag/monitoring/">monitoring</a></li>
                <li><a href="/blog/tag/multipathd/">multipathd</a></li>
                <li><a href="/blog/tag/mustache/">mustache</a></li>
                <li><a href="/blog/tag/networking/">networking</a></li>
                <li><a href="/blog/tag/opennms/">opennms</a></li>
                <li><a href="/blog/tag/opensource/">opensource</a></li>
                <li><a href="/blog/tag/oracle/">oracle</a></li>
                <li><a href="/blog/tag/patching/">patching</a></li>
                <li><a href="/blog/tag/pcre/">pcre</a></li>
                <li><a href="/blog/tag/perl/">perl</a></li>
                <li><a href="/blog/tag/posix/">posix</a></li>
                <li><a href="/blog/tag/programming/">programming</a></li>
                <li><a href="/blog/tag/provisioning/">provisioning</a></li>
                <li><a href="/blog/tag/red-hat/">red hat</a></li>
                <li><a href="/blog/tag/redhat/">redhat</a></li>
                <li><a href="/blog/tag/regex/">regex</a></li>
                <li><a href="/blog/tag/rhev/">rhev</a></li>
                <li><a href="/blog/tag/san/">san</a></li>
                <li><a href="/blog/tag/satellite/">satellite</a></li>
                <li><a href="/blog/tag/scripting/">scripting</a></li>
                <li><a href="/blog/tag/security/">security</a></li>
                <li><a href="/blog/tag/serverspec/">serverspec</a></li>
                <li><a href="/blog/tag/shell/">shell</a></li>
                <li><a href="/blog/tag/software-testing/">software testing</a></li>
                <li><a href="/blog/tag/solaris/">solaris</a></li>
                <li><a href="/blog/tag/spacewalk/">spacewalk</a></li>
                <li><a href="/blog/tag/ssh/">ssh</a></li>
                <li><a href="/blog/tag/statocles/">statocles</a></li>
                <li><a href="/blog/tag/subversion/">subversion</a></li>
                <li><a href="/blog/tag/sun/">sun</a></li>
                <li><a href="/blog/tag/support/">support</a></li>
                <li><a href="/blog/tag/svn/">svn</a></li>
                <li><a href="/blog/tag/sysadmin/">sysadmin</a></li>
                <li><a href="/blog/tag/sysctl/">sysctl</a></li>
                <li><a href="/blog/tag/terraform/">terraform</a></li>
                <li><a href="/blog/tag/virus/">virus</a></li>
                <li><a href="/blog/tag/vitualization/">vitualization</a></li>
                <li><a href="/blog/tag/website/">website</a></li>
            </ul>
        </nav>
    </div>

</div>

<div class="row">
   <div class="col-md-1">
       <img atl="Neil Watson" src="https://gravatar.com/avatar/1f0969599955a953e592034929ed7a23">
   </div>

       <div class="col-md-1">
            <!-- reddit this -->
            <a href="//www.reddit.com/submit" onclick="window.location = &#39;//www.reddit.com/submit?url=&#39; + encodeURIComponent(window.location); return false"><img alt="submit to reddit" border="0" src="//www.redditstatic.com/spreddit7.gif"></a>
       </div>

       <div class="col-md-1">
          <!-- Tweet this -->
          <a class="twitter-share-button" data-count="none" data-via="neil_h_watson" href="https://twitter.com/share">Tweet</a>
    <script>!function(d,s,id){var js,fjs=d.getElementsByTagName(s)[0],p=/^http:/.test(d.location)?'http':'https';if(!d.getElementById(id)){js=d.createElement(s);js.id=id;js.src=p+'://platform.twitter.com/widgets.js';fjs.parentNode.insertBefore(js,fjs);}}(document, 'script', 'twitter-wjs');</script>
       </div>

       <div class="col-md-1">
          <!-- follow me on twitter -->
          <a class="twitter-follow-button" data-show-count="false" data-show-screen-name="false" href="https://twitter.com/neil_h_watson">Follow @neil_h_watson</a>
<script>!function(d,s,id){var js,fjs=d.getElementsByTagName(s)[0],p=/^http:/.test(d.location)?'http':'https';if(!d.getElementById(id)){js=d.createElement(s);js.id=id;js.src=p+'://platform.twitter.com/widgets.js';fjs.parentNode.insertBefore(js,fjs);}}(document, 'script', 'twitter-wjs');</script>
        </div>

       <div class="col-md-1">
           <!-- follw me on github -->
            <a aria-label="Follow @neilhwatson on GitHub" class="github-button" data-style="mega" href="https://github.com/neilhwatson">Follow</a>
            <script async defer id="github-bjs" src="https://buttons.github.io/buttons.js"></script>
       </div>

</div>

        </div>
        <footer>
            
            <h1></h1>
            <div class="col-md-5"> </div>
            <div class="col-md-3 container tagline">
                <a href="http://preaction.me/statocles">Made with Statocles</a><br>
                <a href="http://www.perl.org">Powered by Perl</a>
            </div>
        </footer>
    </body>
</html>
